<!DOCTYPE html>
<html>

<head>
    <title>Watchface view</title>
    <style>
        html,
        body,
        main {
            margin: 0;
            padding: 0;
        }

        body {
            overflow-x: hidden;
        }

        img {
            position: absolute;
            top: 180px;
        }

        #watchfaceimage {
            background: url(b.png);
            padding-left: 43px;
            padding-top: 163px;
            height: 353px;
            position: relative;
            width: 233px;
        }

        #watchfaceblock {
            position: relative;
            height: 176px;
            width: 176px;
        }

        #watchface,
        .watchface-cover {
            position: absolute;
            top: 0;
            height: 176px;
            width: 176px;
        }
        #codearea{
            height: 370px;
        }
        .string { color: green; }
.number { color: #2CB3FC; }
.boolean { color: blue; }
.null { color: magenta; }
.key { color: #0234D9; }

    </style>
    <link href="uikit/uikit.min.css" rel="stylesheet">
    <script src="uikit/uikit.min.js"></script>
</head>

<body>
    <div class="uk-section-primary uk-preserve-color">
        <nav class="uk-navbar-container" style="background: linear-gradient(to left, #28a5f5, #1e87f0);">
            <div class="uk-container uk-container-expand">
                <div uk-navbar>
                    <div class="uk-navbar-left">
                        <a class="uk-navbar-item uk-logo" href="#" style="color: white">Bip watchface view</a>
                        <a class="uk-navbar-item" style="color: white" href="#modal-howto" uk-toggle>How to use</a>
                        <a class="uk-navbar-item" style="color: white" href="#modal-feedback" uk-toggle>Send feedback</a>
                        <div id="modal-howto" uk-modal>
                            <div class="uk-modal-dialog uk-modal-body">
                                <h2 class="uk-modal-title">How to use</h2>
                                <p>Disassemble <b>.bin</b> file with <a href="https://bitbucket.org/valeronm/amazfitbiptools/downloads/">AmazfitBipTools</a>, click on <b>Select images</b> and select them from watchface folder by <b>Ctrl+A</b>, then select JSON file by clicking on <b>JSON Select</b>. After that you can set numbers to display by clicking <b>Settings</b> or edit the watchface (in development)
                                <br><br>Also you can edit JSON on tab <b>Code</b>. To update preview just click out of JSON input</p>
                                <p class="uk-text-right">
                                    <button class="uk-button uk-button-default uk-modal-close" type="button">Close</button>
                                </p>
                            </div>
                        </div>
                        <div id="modal-feedback" uk-modal>
                            <div class="uk-modal-dialog uk-modal-body">
                                <h2 class="uk-modal-title">Feedback</h2>
                                <p>You can send feedback by Telegram to <a href="https://t.me/vlack">@vlack</a></p>
                                <p class="uk-text-right">
                                    <button class="uk-button uk-button-default uk-modal-close" type="button">Close</button>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="uk-navbar-right">
                        <ul class="uk-navbar-nav">
                            <a class="uk-navbar-item" href="https://amazfitwatchfaces.com/" style="color: white">Home</a>
                            <a class="uk-navbar-item" href="https://amazfitwatchfaces.com/manual/" style="color: white">Manual</a>
                            <a class="uk-navbar-item" href="https://amazfitwatchfaces.com/watchface/upLoad/" style="color: white">Upload</a>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
    </div>
    <main class="uk-container uk-position-relative uk-margin-top">
        <div class="uk-grid">
            <div class="uk-width-auto uk-first-column">
                <div id="watchfaceimage">
                    <div id="watchfaceblock">
                        <div id="watchface"></div>
                        <div class="watchface-cover">
                            <svg id="svg-cont-steps" width="176" height="176"></svg>
                        </div>
                        <div class="watchface-cover" style="top: 0;position: relative;">
                            <svg id="svg-cont-clock" width="176" height="176"></svg>
                        </div>
                    </div>
                </div>
            </div>
            <div id="inputblock" class="uk-width-expand uk-padding" style="padding-top: 0;">
                <ul class="uk-tab" uk-switcher="connect: .switcher-container">
                    <li><a href="#">View</a></li>
                    <li id="editbutton" class="uk-disabled" onclick="editor.init.time();"><a href="#">Edit</a></li>
                    <li id="codeopenbutton" class="uk-disabled" onclick="fillarea();"><a href="#">Code</a></li>
                </ul>
                <ul class="uk-switcher switcher-container uk-margin">
                    <li>
                        <div class="js-upload" uk-form-custom>
                            <span>Images: </span>
                            <input id="inputimages" type="file" multiple accept=".png" onclick="clearimg()">
                            <button class="uk-button uk-button-default uk-button-small" type="button" tabindex="-1">Select</button>
                        </div>
                        <br>
                        <div class="js-upload uk-margin" uk-form-custom>
                            <span>JSON: </span>
                            <input id="inputjs" type="file" accept=".json" onclick="clearjs()">
                            <button class="uk-button uk-button-default uk-button-small" type="button" tabindex="-1">Select</button>
                        </div>
                        <br>
                        <button id="viewsettings" class="uk-button uk-button-default" type="button" uk-toggle="target: #vars; animation: uk-animation-fade" disabled>Settings</button>
                        <button id="makepng" class="uk-button uk-button-default" onclick="makepng()" disabled>Make PNG</button>
                        <label><input id="makepngwithwatch" class="uk-checkbox" type="checkbox"> With watch</label>
                        <div id="vars" hidden class="uk-margin-top uk-card uk-card-default uk-card-body">
                            <div class="uk-card-badge uk-label">Beta</div>
                            <h3 class="uk-card-title">Settings</h3>
                            <form class="uk-grid-small" uk-grid>
                                <div class="uk-width-1-4@s">
                                    <label class="uk-form-label">Time</label>
                                    <div class="uk-form-controls">
                                        <input class="uk-input" id="in-time" type="time" value="20:38">
                                    </div>
                                </div>
                                <div class="uk-width-1-4@s">
                                    <label class="uk-form-label">Date</label>
                                    <div class="uk-form-controls">
                                        <input class="uk-input" id="in-date" type="date" value="2017-12-06">
                                    </div>
                                </div>
                                <div class="uk-width-1-4@s">
                                    <label class="uk-form-label">Battery</label>
                                    <div class="uk-form-controls">
                                        <input class="uk-input" id="in-battery" type="number" placeholder="Battery" min="0" max="100">
                                    </div>
                                </div>
                                <div class="uk-width-1-4@s">
                                    <label class="uk-form-label">Calories</label>
                                    <div class="uk-form-controls">
                                        <input class="uk-input" id="in-calories" type="number" placeholder="Calories" min="0" max="9999">
                                    </div>
                                </div>
                                <div class="uk-width-1-4@s">
                                    <label class="uk-form-label">Steps</label>
                                    <div class="uk-form-controls">
                                        <input class="uk-input" id="in-steps" type="number" placeholder="Steps" min="0" max="99999">
                                    </div>
                                </div>
                                <div class="uk-width-1-4@s">
                                    <label class="uk-form-label">Steps goal</label>
                                    <div class="uk-form-controls">
                                        <input class="uk-input" id="in-stepsgoal" type="number" placeholder="Steps goal" min="0" max="99999">
                                    </div>
                                </div>
                                <div class="uk-width-1-4@s">
                                    <label class="uk-form-label">Pulse</label>
                                    <div class="uk-form-controls">
                                        <input class="uk-input" id="in-pulse" type="number" placeholder="Pulse" min="0" max="99999">
                                    </div>
                                </div>
                                <div class="uk-width-1-4@s">
                                    <label class="uk-form-label">Distance</label>
                                    <div class="uk-form-controls">
                                        <input class="uk-input" id="in-distance" type="number" placeholder="Distance" min="0" max="99999">
                                    </div>
                                </div>
                                <div class="uk-width-1-4@s">
                                    <label class="uk-form-label">Weather day</label>
                                    <div class="uk-form-controls">
                                        <input class="uk-input" id="in-weatherd" type="number" placeholder="Weather day" min="-99" max="99">
                                    </div>
                                </div>
                                <div class="uk-width-1-4@s">
                                    <label class="uk-form-label">Weather night</label>
                                    <div class="uk-form-controls">
                                        <input class="uk-input" id="in-weathern" type="number" placeholder="Weather night" min="-99" max="99">
                                    </div>
                                </div>
                                <div class="uk-width-1-4@s">
                                    <label class="uk-form-label">Seconds</label>
                                    <div class="uk-form-controls">
                                        <input class="uk-input" id="in-sec" type="number" placeholder="Seconds" min="0" max="59">
                                    </div>
                                </div>
                                <div class="uk-width-1-4@s">
                                    <label class="uk-form-label">Status</label>
                                    <div class="uk-form-controls uk-child-width-auto uk-grid">
                                        <label><input class="uk-checkbox" type="checkbox" checked id="in-alarm"> Alarm</label>
                                        <label><input class="uk-checkbox" type="checkbox" checked id="in-bt"> Bluetooth</label>
                                        <label><input class="uk-checkbox" type="checkbox" checked id="in-dnd"> Do not disturb</label>
                                        <label><input class="uk-checkbox" type="checkbox" checked id="in-lock"> Lock</label>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </li>
                    <li>
                        <ul uk-accordion>
                            <li class="uk-open">
                                <h3 class="uk-accordion-title">Time</h3>
                                <div class="uk-accordion-content">
                                    <form>

                                        <div class="uk-margin uk-grid-small uk-child-width-auto uk-grid">
                                            <label class="uk-form-label">Time format</label>
                                            <label><input class="uk-radio" type="radio" name="radio2" id="c-time-rad-24"> 24-hours</label>
                                            <label><input class="uk-radio" type="radio" name="radio2" id="c-time-rad-12"> 12-hours</label>
                                            <label><input class="uk-checkbox" type="checkbox" id="c-time-check-sec"> Show seconds</label>
                                        </div>

                                        <div class="uk-grid-small" uk-grid>
                                            <div class="uk-grid-margin" style="width: 85px;">
                                                <label class="uk-form-label">Hours tens</label>
                                                <div class="uk-form-controls">
                                                    <input class="uk-input uk-form-small" id="c-time-ht-x" type="number" placeholder="X" min="0" max="176" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-ht-y" type="number" placeholder="Y" min="0" max="176" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-ht-f" type="number" placeholder="Frist" min="0" max="176" title="First image index" uk-tooltip="delay: 500; pos: bottom" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-ht-c" type="number" placeholder="Count" min="0" max="176" title="Number of images" uk-tooltip="delay: 500; pos: bottom" onchange="editor.onchange.time();">
                                                </div>
                                            </div>
                                            <div style="width: 85px;">
                                                <label class="uk-form-label">Hours ones</label>
                                                <div class="uk-form-controls">
                                                    <input class="uk-input uk-form-small" id="c-time-ho-x" type="number" placeholder="X" min="0" max="176" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-ho-y" type="number" placeholder="Y" min="0" max="176" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-ho-f" type="number" placeholder="Frist" min="0" max="176" title="First image index" uk-tooltip="delay: 500; pos: bottom" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-ho-c" type="number" placeholder="Count" min="0" max="176" title="Number of images" uk-tooltip="delay: 500; pos: bottom" onchange="editor.onchange.time();">
                                                </div>
                                            </div>
                                            <div style="width: 85px;">
                                                <label class="uk-form-label">Minutes tens</label>
                                                <div class="uk-form-controls">
                                                    <input class="uk-input uk-form-small" id="c-time-mt-x" type="number" placeholder="X" min="0" max="176" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-mt-y" type="number" placeholder="Y" min="0" max="176" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-mt-f" type="number" placeholder="Frist" min="0" max="176" title="First image index" uk-tooltip="delay: 500; pos: bottom" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-mt-c" type="number" placeholder="Count" min="0" max="176" title="Number of images" uk-tooltip="delay: 500; pos: bottom" onchange="editor.onchange.time();">
                                                </div>
                                            </div>
                                            <div style="width: 85px;">
                                                <label class="uk-form-label">Minutes ones</label>
                                                <div class="uk-form-controls">
                                                    <input class="uk-input uk-form-small" id="c-time-mo-x" type="number" placeholder="X" min="0" max="176" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-mo-y" type="number" placeholder="Y" min="0" max="176" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-mo-f" type="number" placeholder="Frist" min="0" max="176" title="First image index" uk-tooltip="delay: 500; pos: bottom" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-mo-c" type="number" placeholder="Count" min="0" max="176" title="Number of images" uk-tooltip="delay: 500; pos: bottom" onchange="editor.onchange.time();">
                                                </div>
                                            </div>
                                            <div style="width: 85px;">
                                                <label class="uk-form-label">Seconds tens</label>
                                                <div class="uk-form-controls">
                                                    <input class="uk-input uk-form-small" id="c-time-st-x" type="number" placeholder="X" min="0" max="176" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-st-y" type="number" placeholder="Y" min="0" max="176" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-st-f" type="number" placeholder="Frist" min="0" max="176" title="First image index" uk-tooltip="delay: 500; pos: bottom" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-st-c" type="number" placeholder="Count" min="0" max="176" title="Number of images" uk-tooltip="delay: 500; pos: bottom" onchange="editor.onchange.time();">
                                                </div>
                                            </div>
                                            <div style="width: 85px;">
                                                <label class="uk-form-label">Seconds ones</label>
                                                <div class="uk-form-controls">
                                                    <input class="uk-input uk-form-small" id="c-time-so-x" type="number" placeholder="X" min="0" max="176">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-so-y" type="number" placeholder="Y" min="0" max="176">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-so-f" type="number" placeholder="Frist" min="0" max="176" title="First image index" uk-tooltip="delay: 500; pos: bottom">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-so-c" type="number" placeholder="Count" min="0" max="176" title="Number of images" uk-tooltip="delay: 500; pos: bottom">
                                                </div>
                                            </div>
                                            <div style="width: 85px;">
                                                <label class="uk-form-label">AM/PM</label>
                                                <div class="uk-form-controls">
                                                    <input class="uk-input uk-form-small" id="c-time-format-x" type="number" placeholder="X" min="0" max="176" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-format-y" type="number" placeholder="Y" min="0" max="176" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-format-a" type="number" placeholder="AM" min="0" max="176" title="AM image index" uk-tooltip="delay: 500; pos: bottom" onchange="editor.onchange.time();">
                                                </div>
                                                <div class="uk-form-controls" style="margin-top: 5px;">
                                                    <input class="uk-input uk-form-small" id="c-time-format-p" type="number" placeholder="PM" min="0" max="176" title="PM image index" uk-tooltip="delay: 500; pos: bottom" onchange="editor.onchange.time();">
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </li>
                            <li>
                                <h3 class="uk-accordion-title">Date</h3>
                                <div class="uk-accordion-content">
                                    <div class="uk-alert-warning" uk-alert>
                                        <h3>In development</h3>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <h3 class="uk-accordion-title">Status</h3>
                                <div class="uk-accordion-content">
                                    <div class="uk-alert-warning" uk-alert>
                                        <h3>In development</h3>
                                    </div>
                                </div>
                            </li>
                        </ul>
                        <button id="exportjs" class="uk-button uk-button-primary uk-margin-top" onclick="exportjs()">Export JSON</button>
                    </li>
                    <li>
                        <div class="uk-margin">
                            <pre contenteditable="true" id="codearea"></pre>
                            <button class="uk-button uk-button-primar" onclick="exportjs()">Export JSON</button>
                        </div>
                    </li>
                </ul>

            </div>
            <div id="allimages" class="uk-invisible">
                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeAQMAAAAB/jzhAAAAAXNSR0IArs4c6QAAAAZQTFRFAAAA////pdmf3QAAAKFJREFUeAEBlgBp/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAfgAAAAH/gAAAA8PAAAAHAOAAAAYAYAAADgBwAAAMADAAADwAPwAA/Dw/wAHgfjHgAYDnQGADgMMAcAMAwwAwAwADADADAAcAMAOADgBwAYAcAGAB4BgB4ADgGAPAACAAAwAAABgAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAABLmFx2EXu51AAAAAElFTkSuQmCC" id="weather">
            </div>
        </div>
    </main>
    <script type="text/javascript">
        var edgeBrowser = navigator.userAgent.search(/Edge/) > 0 ? 1 : 0;
        if (edgeBrowser) {
            UIkit.notification("Something may not work in your browser. WebKit-based browser recommended", {
                status: 'warning',
                pos: 'top-left',
                timeout: 7500
            });
        }

        function $(el) {
            return document.getElementById(el);
        }

        function $c(el) {
            return document.getElementById(el).cloneNode(false);
        }
        var jsset = 0,
            imagesset = 0,
            wfname = "wanchface";
        var timeOnClock = ["20", "38"],
            seconds = [4, 3],
            analog = [259, 228, 60],
            weekDay = 2,
            day = 20,
            month = 12,
            batteryT = 20,
            calories = 860,
            steps = 5687,
            stepsgoal = 12000,
            distance = [5, 67],
            pulse = 72,
            temp = [22, 24],
            alarm = 1,
            bluetooth = 1,
            dnd = 1,
            lock = 1;

        $("in-time").onchange = function() {
            var t = $("in-time").value.split(":");
            timeOnClock[0] = t[0];
            timeOnClock[1] = t[1];
            analog[0] = (t[0] > 12 ? t[0] - 12 : t[0]) * 30 + t[1] * 0.5;
            analog[1] = t[1] * 6;
            $("svg-cont-clock").innerHTML = '';
            if ('AnalogDialFace' in coords) {
                if ('Hours' in coords.AnalogDialFace)
                    draw.analog.hours();
                if ('Minutes' in coords.AnalogDialFace)
                    draw.analog.minutes();
                if ('Seconds' in coords.AnalogDialFace)
                    draw.analog.seconds();
            }
            removeByClass("c_time");
            if ('Time' in coords)
                draw.time.time();
        }
        $("in-date").onchange = function() {
            var t = $("in-date").valueAsDate;
            try {
                day = t.getDate();
                month = t.getMonth() + 1;
                weekDay = t.getDay() + 1;
                removeByClass("c_date");
                if ('Date' in coords) {
                    if ('WeekDay' in coords.Date)
                        draw.date.weekday();
                    if ('MonthAndDay' in coords.Date) {
                        if ('Separate' in coords.Date.MonthAndDay) {
                            if ('Day' in coords.Date.MonthAndDay.Separate)
                                draw.date.sepday();
                            if ('Month' in coords.Date.MonthAndDay.Separate)
                                draw.date.sepmonth();
                        }
                        if ('OneLine' in coords.Date.MonthAndDay)
                            draw.date.oneline();
                    }
                }
            } catch (e) {}
        }
        $("in-sec").onchange = function() {
            if ($("in-sec").value > 59) $("in-sec").value = 59;
            if ($("in-sec").value < 0) $("in-sec").value = 0;
            var sec = $("in-sec").value;
            seconds[0] = Number(sec.split("")[0]);
            seconds[1] = Number((sec.split("").length == 1 ? 0 : sec.split("")[1]));
            analog[2] = sec * 6;
            $("svg-cont-clock").innerHTML = '';
            if ('AnalogDialFace' in coords) {
                if ('Hours' in coords.AnalogDialFace)
                    draw.analog.hours();
                if ('Minutes' in coords.AnalogDialFace)
                    draw.analog.minutes();
                if ('Seconds' in coords.AnalogDialFace)
                    draw.analog.seconds();
            }
            removeByClass("c_sec");
            if ('Time' in coords)
                if ('Seconds' in coords.Time)
                    draw.time.seconds();
        }
        $("in-battery").onchange = function() {
            if ($("in-battery").value > 100) $("in-battery").value = 100;
            if ($("in-battery").value < 0) $("in-battery").value = 0;
            batteryT = $("in-battery").value;
            removeByClass("c_battery_icon");
            removeByClass("c_battery_scale");
            removeByClass("c_battery_text");
            if ('Battery' in coords) {
                if ('Icon' in coords.Battery)
                    draw.battery.icon();
                if ('Text' in coords.Battery)
                    draw.battery.text();
                if ('Scale' in coords.Battery)
                    draw.battery.scale();
            }
        }
        $("in-alarm").onchange = function() {
            alarm = $("in-alarm").checked;
            removeByClass("c_stat_alarm");
            if ('Status' in coords)
                if ('Alarm' in coords.Status && alarm)
                    draw.status.alarm();
        }
        $("in-bt").onchange = function() {
            bluetooth = $("in-bt").checked;
            removeByClass("c_stat_bt");
            if ('Status' in coords)
                if ('Bluetooth' in coords.Status)
                    draw.status.bt();

        }
        $("in-dnd").onchange = function() {
            dnd = $("in-dnd").checked;
            removeByClass("c_stat_dnd");
            if ('Status' in coords)
                if ('DoNotDisturb' in coords.Status && dnd)
                    draw.status.dnd();
        }
        $("in-lock").onchange = function() {
            lock = $("in-lock").checked;
            removeByClass("c_stat_lock");
            if ('Status' in coords)
                if ('Lock' in coords.Status && lock)
                    draw.status.lock();
        }
        $("in-steps").onchange = function() {
            if ($("in-steps").value > 99999) $("in-steps").value = 99999;
            if ($("in-steps").value < 0) $("in-steps").value = 0;
            steps = $("in-steps").value;
            removeByClass("c_act_steps");
            if ('Activity' in coords)
                if ('Steps' in coords.Activity)
                    draw.activity.steps();
            removeByClass("c_steps_linear");
            $("svg-cont-steps").innerHTML = '';
            if ('StepsProgress' in coords) {
                if ('Circle' in coords.StepsProgress)
                    draw.stepsprogress.circle();
                if ('Linear' in coords.StepsProgress)
                    draw.stepsprogress.linear();
            }
        }
        $("in-distance").onchange = function() {
            if ($("in-distance").value > 99) $("in-distance").value = 99;
            if ($("in-distance").value < 0) $("in-distance").value = 0;
            var dist = $("in-distance").value.split(".");
            distance[0] = Number(dist[0]);
            distance[1] = dist.length > 1 ? dist[1].slice(0, 2) : "00";
            removeByClass("c_act_distance");
            if ('Activity' in coords)
                if ('Distance' in coords.Activity)
                    draw.activity.distance();
        }
        $("in-pulse").onchange = function() {
            if ($("in-pulse").value > 999) $("in-pulse").value = 999;
            if ($("in-pulse").value < 0) $("in-pulse").value = 0;
            pulse = $("in-pulse").value;
            removeByClass("c_act_pulse");
            if ('Activity' in coords)
                if ('Pulse' in coords.Activity)
                    draw.activity.pulse();
        }
        $("in-calories").onchange = function() {
            if ($("in-calories").value > 9999) $("in-calories").value = 9999;
            if ($("in-calories").value < 0) $("in-calories").value = 0;
            calories = $("in-calories").value;
            removeByClass("c_act_cal");
            if ('Activity' in coords)
                if ('Calories' in coords.Activity)
                    draw.activity.cal();
        }
        $("in-stepsgoal").onchange = function() {
            if ($("in-stepsgoal").value > 99999) $("in-stepsgoal").value = 99999;
            if ($("in-stepsgoal").value < 0) $("in-stepsgoal").value = 0;
            stepsgoal = $("in-stepsgoal").value;
            if (stepsgoal == 75321)
                $("editbutton").classList.remove("uk-disabled");
            removeByClass("c_act_stepsgoal");
            if ('Activity' in coords)
                if ('StepsGoal' in coords.Activity)
                    draw.activity.stepsgoal();
        }
        $("in-weatherd").onchange = function() {
            if ($("in-weatherd").value > 99) $("in-weatherd").value = 99;
            if ($("in-weatherd").value < -99) $("in-weatherd").value = -99;
            temp[0] = $("in-weatherd").value;
            removeByClass("c_temp");
            if ('Weather' in coords) {
                if ('Icon' in coords.Weather)
                    draw.weather.icon();
                if ('Temperature' in coords.Weather) {
                    if ('Today' in coords.Weather.Temperature) {
                        if ('OneLine' in coords.Weather.Temperature.Today)
                            draw.weather.temp.oneline();
                        if ('Separate' in coords.Weather.Temperature.Today)
                            draw.weather.temp.sep();
                    }
                    if ('Current' in coords.Weather.Temperature)
                        draw.weather.temp.current();
                }
                if ('AirPollution' in coords.Weather)
                    draw.weather.air();
            }
        }
        $("in-weathern").onchange = function() {
            if ($("in-weathern").value > 99) $("in-weathern").value = 99;
            if ($("in-weathern").value < -99) $("in-weathern").value = -99;
            temp[1] = $("in-weathern").value;
            removeByClass("c_temp");
            if ('Weather' in coords)
                if ('Temperature' in coords.Weather)
                    if ('Today' in coords.Weather.Temperature) {
                        if ('OneLine' in coords.Weather.Temperature.Today)
                            draw.weather.temp.oneline();
                        if ('Separate' in coords.Weather.Temperature.Today)
                            draw.weather.temp.sep();
                    }
        }

        function disableBtn(i) {
            if (i) {
                //$("editbutton").classList.remove("uk-disabled");
                $("makepng").removeAttribute("disabled");
                $("viewsettings").removeAttribute("disabled");
                $("codeopenbutton").classList.remove("uk-disabled");
                setTimeout(makeWf, 100);
            } else {
                $("editbutton").classList.add("uk-disabled");
                $("makepng").setAttribute("disabled", "");
                $("viewsettings").setAttribute("disabled", "");
                $("codeopenbutton").classList.add("uk-disabled");
            }
        }
        var coords;

        function makeBlock(el, value) {
            value = value.toString();
            var block = Array(),
                width = 0,
                t;
            while (value != "") {
                t = $c(el.ImageIndex + Number(value[0]));
                block.push(t);
                width += t.width + el.Spacing;
                value = value.substr(1);
            }
            width = width - el.Spacing;
            return {
                block,
                width
            }
        }

        function renderBlock(block, width, el, cls) {
            var t, offset = 0;
            if (el.Alignment == 18) {
                block.reverse();
                while (block.length) {
                    t = block.pop();
                    t.style.left = el.TopLeftX + offset + "px";
                    t.style.top = el.TopLeftY + "px";
                    insert(t, cls);
                    offset += t.width + el.Spacing;
                }
            } else if (el.Alignment == 20) {
                while (block.length) {
                    t = block.pop();
                    t.style.left = el.BottomRightX - t.width + 1 - offset + "px";
                    t.style.top = el.TopLeftY + "px";
                    insert(t, cls);
                    offset += t.width + el.Spacing;
                }
            } else if (el.Alignment == 34) {
                while (block.length) {
                    t = block.pop();
                    t.style.left = el.BottomRightX - t.width + 1 - offset + "px";
                    t.style.top = el.BottomRightY - t.height + 1 + "px";
                    insert(t, cls);
                    offset += t.width + el.Spacing;
                }
            } else if (el.Alignment == 24) {
                block.reverse();
                offset = div(((el.BottomRightX - el.TopLeftX + 1) - width), 2);
                //console.log(offset);
                while (block.length) {
                    t = block.pop();
                    t.style.left = el.TopLeftX + offset + "px";
                    t.style.top = el.TopLeftY + "px";
                    insert(t, cls);
                    offset += t.width + el.Spacing;
                }
            }
        }

        function clearjs() {
            $('inputjs').value = '';
            coords = 0;
            jsset = 0;
            if ($('inputjs').nextElementSibling.classList.contains("uk-label-success"))
                $('inputjs').nextElementSibling.classList.remove("uk-label-success");
            $('inputjs').nextElementSibling.classList.add("uk-button-danger");
            disableBtn(0);
        }

        function clearimg() {
            $('inputimages').value = '';
            imagesset = 0;
            if ($('inputimages').nextElementSibling.classList.contains("uk-label-success")) $('inputimages').nextElementSibling.classList.remove("uk-label-success");
            $('inputimages').nextElementSibling.classList.add("uk-button-danger");
            $('allimages').innerHTML = "<img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeAQMAAAAB/jzhAAAAAXNSR0IArs4c6QAAAAZQTFRFAAAA////pdmf3QAAAKFJREFUeAEBlgBp/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAfgAAAAH/gAAAA8PAAAAHAOAAAAYAYAAADgBwAAAMADAAADwAPwAA/Dw/wAHgfjHgAYDnQGADgMMAcAMAwwAwAwADADADAAcAMAOADgBwAYAcAGAB4BgB4ADgGAPAACAAAwAAABgAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAABLmFx2EXu51AAAAAElFTkSuQmCC\" id=\"weather\">";
            disableBtn(0);
        }

        function div(a, b) {
            return (a - a % b) / b;
        }

        function removeByClass(cl) {
            var els = document.getElementsByClassName(cl);
            for (var i = 0; els.length; i++)
                $("watchface").removeChild(els[0]);
        }

        function renderImage(file) {
            var reader = new FileReader();
            reader.onload = function(event) {
                the_url = event.target.result;
                $('allimages').innerHTML += "<img src=\"" + the_url + "\" id=\"" + file.name.replace('.png', '') + "\" >";
            }
            reader.readAsDataURL(file);
            delete reader;
        }
        $('inputimages').onchange = function() {
            if (this.files.length) {
                var i = 0;
                console.log("Images count: ", this.files.length);
                while (i < this.files.length) {
                    renderImage(this.files[i]);
                    i++;
                }
                imagesset = 1;
                if ($('inputimages').nextElementSibling.classList.contains("uk-button-danger"))
                    $('inputimages').nextElementSibling.classList.remove("uk-button-danger");
                $('inputimages').nextElementSibling.classList.add("uk-label-success");
            }
            if (imagesset && jsset)
                disableBtn(1);
            else
                disableBtn(0);
        }
        $('inputjs').onchange = function() {
            if (this.files.length) {
                wfname = this.files[0].name.split(".")[0];
                console.log("Watchface name: ", wfname);
                document.title = "Watchface view " + wfname;
                var reader = new FileReader();
                reader.onload = function(e) {
                    coords = JSON.parse(e.target.result);
                };
                reader.readAsText(this.files[0]);
                delete reader;
                jsset = 1;
                if ($('inputjs').nextElementSibling.classList.contains("uk-button-danger"))
                    $('inputjs').nextElementSibling.classList.remove("uk-button-danger");
                $('inputjs').nextElementSibling.classList.add("uk-label-success");
            }
            if (imagesset && jsset)
                disableBtn(1);
            else
                disableBtn(0);
        }

        function setPos(t, el) {
            t.style.left = el.X + "px";
            t.style.top = el.Y + "px";
        }

        function setPosN(el, value, cls) {
            t = $c(el.ImageIndex + value);
            t.style.left = el.X + "px";
            t.style.top = el.Y + "px";
            insert(t, cls);
        }

        function insert(t, name) {
            t.removeAttribute('id');
            t.setAttribute("class", name)
            $("watchface").appendChild(t);
        }

        function setTextPos(el, value, cls) {
            var t = makeBlock(el, value);
            renderBlock(t.block, t.width, el, cls);
        }

        function drowAnalog(el, value) {
            var col = el.Color.replace("0x", "#"),
                d = "M " + el.Shape[0].X + " " + el.Shape[0].Y,
                iters = el.Shape.length,
                fill = el.OnlyBorder ? "none" : col;
            for (var i = 0; i < iters; i++) {
                d += "L " + el.Shape[i].X + " " + el.Shape[i].Y + " ";
            }
            d += "L " + el.Shape[0].X + " " + el.Shape[0].Y + " ";
            $('svg-cont-clock').innerHTML += "<path d=\"" + d + "\" transform=\"rotate(" + value + " " + el.Center.X + " " + el.Center.Y + ") rotate(-90 " + el.Center.X + " 0)\" fill=\"" + fill + "\" stroke=\"" + col + "\"></path>";
            if ('CenterImage' in el) {
                setPosN(el.CenterImage, 0, "c_an_img");
            }
        }

        function makeWf() {
            try {
                $("watchface").innerHTML = '';
                $("svg-cont-clock").innerHTML = '';
                $("svg-cont-steps").innerHTML = '';
                UIkit.notification.closeAll()
                var t = 0;
                if ('Background' in coords)
                    setPosN(coords.Background.Image, 0, "c_bg");
                if ('Time' in coords) {
                    if ('Seconds' in coords.Time)
                        draw.time.seconds();
                    draw.time.time();
                }
                if ('Date' in coords) {
                    if ('WeekDay' in coords.Date)
                        draw.date.weekday();
                    if ('MonthAndDay' in coords.Date) {
                        if ('Separate' in coords.Date.MonthAndDay) {
                            if ('Day' in coords.Date.MonthAndDay.Separate)
                                draw.date.sepday();
                            if ('Month' in coords.Date.MonthAndDay.Separate)
                                draw.date.sepmonth();
                        }
                        if ('OneLine' in coords.Date.MonthAndDay)
                            draw.date.oneline();
                    }
                }
                if ('Battery' in coords) {
                    if ('Icon' in coords.Battery)
                        draw.battery.icon();
                    if ('Text' in coords.Battery)
                        draw.battery.text();
                    if ('Scale' in coords.Battery)
                        draw.battery.scale();
                }

                if ('Status' in coords) {
                    if ('Alarm' in coords.Status && alarm)
                        draw.status.alarm();
                    if ('Bluetooth' in coords.Status)
                        draw.status.bt();
                    if ('DoNotDisturb' in coords.Status && dnd)
                        draw.status.dnd();
                    if ('Lock' in coords.Status && lock)
                        draw.status.lock();
                }
                if ('Activity' in coords) {
                    if ('Calories' in coords.Activity)
                        draw.activity.cal();
                    if ('Steps' in coords.Activity)
                        draw.activity.steps();
                    if ('StepsGoal' in coords.Activity)
                        draw.activity.stepsgoal();
                    if ('Pulse' in coords.Activity)
                        draw.activity.pulse();
                    if ('Distance' in coords.Activity)
                        draw.activity.distance();
                }
                if ('Weather' in coords) {
                    if ('Icon' in coords.Weather)
                        draw.weather.icon();
                    if ('Temperature' in coords.Weather) {
                        if ('Today' in coords.Weather.Temperature) {
                            if ('OneLine' in coords.Weather.Temperature.Today)
                                draw.weather.temp.oneline();
                            if ('Separate' in coords.Weather.Temperature.Today)
                                draw.weather.temp.sep();
                        }
                        if ('Current' in coords.Weather.Temperature)
                            draw.weather.temp.current();
                    }
                    if ('AirPollution' in coords.Weather)
                        draw.weather.air();
                }
                if ('StepsProgress' in coords) {
                    if ('Circle' in coords.StepsProgress)
                        draw.stepsprogress.circle();
                    if ('Linear' in coords.StepsProgress)
                        draw.stepsprogress.linear();
                }
                if ('AnalogDialFace' in coords) {
                    if ('Hours' in coords.AnalogDialFace)
                        draw.analog.hours();
                    if ('Minutes' in coords.AnalogDialFace)
                        draw.analog.minutes();
                    if ('Seconds' in coords.AnalogDialFace)
                        draw.analog.seconds();
                }
            } catch (error) {
                console.error(error);
                if (error.name == "TypeError") {
                    UIkit.notification("Image for prorety not found", {
                        status: 'danger',
                        pos: 'top-left',
                        timeout: 7500
                    });
                }
            }
        }
        var draw = {};
        draw.activity = {};
        draw.status = {};
        draw.analog = {};
        draw.battery = {};
        draw.date = {};
        draw.time = {};
        draw.stepsprogress = {};
        draw.weather = {};
        draw.weather.temp = {};

        draw.time.time = function() {
            var ntimeOnClock = timeOnClock[0];
            if ('AmPm' in coords.Time) {
                var am = 1;
                if (Number(ntimeOnClock) > 12) {
                    ntimeOnClock = (Number(ntimeOnClock) - 12).toString();
                    if (ntimeOnClock.length == 1)
                        ntimeOnClock = "0" + ntimeOnClock;
                    am = 0;
                }
                t = am ? $c(coords.Time.AmPm.ImageIndexAm) : $c(coords.Time.AmPm.ImageIndexPm);
                setPos(t, coords.Time.AmPm);
                insert(t, "c_time_am");

            }
            setPosN(coords.Time.Hours.Tens, Number(ntimeOnClock[0]), "c_time");
            setPosN(coords.Time.Hours.Ones, Number(ntimeOnClock[1]), "c_time");
            setPosN(coords.Time.Minutes.Tens, Number(timeOnClock[1][0]), "c_time");
            setPosN(coords.Time.Minutes.Ones, Number(timeOnClock[1][1]), "c_time");
        }
        draw.time.seconds = function() {
            setPosN(coords.Time.Seconds.Tens, seconds[0], "c_sec");
            setPosN(coords.Time.Seconds.Ones, seconds[1], "c_sec");
        }
        draw.date.weekday = function() {
            setPosN(coords.Date.WeekDay, weekDay, "c_date");
        }
        draw.date.sepday = function() {
            //setTextPos(coords.Date.MonthAndDay.Separate.Day, day, "c_date");
            var t = makeBlock(coords.Date.MonthAndDay.Separate.Day, day);
            if (coords.Date.MonthAndDay.TwoDigitsDay)
                if (!div(day, 10)) {
                    t.block.splice(-1, 0, $c(coords.Date.MonthAndDay.Separate.Day.ImageIndex));
                    t.width += $(coords.Date.MonthAndDay.Separate.Day.ImageIndex).width + coords.Date.MonthAndDay.Separate.Day.Spacing;
                }
            renderBlock(t.block, t.width, coords.Date.MonthAndDay.Separate.Day, "c_date");
        }
        draw.date.sepmonth = function() {
            var t = makeBlock(coords.Date.MonthAndDay.Separate.Month, month);
            if (coords.Date.MonthAndDay.TwoDigitsMonth)
                if (!div(month, 10)) {
                    t.block.splice(-1, 0, $c(coords.Date.MonthAndDay.Separate.Month.ImageIndex));
                    t.width += $(coords.Date.MonthAndDay.Separate.Month.ImageIndex).width + coords.Date.MonthAndDay.Separate.Month.Spacing;
                }
            renderBlock(t.block, t.width, coords.Date.MonthAndDay.Separate.Month, "c_date");
        }
        draw.date.oneline = function() {
            var dot = $c(coords.Date.MonthAndDay.OneLine.DelimiterImageIndex);
            t = makeBlock(coords.Date.MonthAndDay.OneLine.Number, month);
            if (coords.Date.MonthAndDay.TwoDigitsMonth)
                if (!div(month, 10)) {
                    t.block.splice(-1, 0, $c(coords.Date.MonthAndDay.OneLine.Number.ImageIndex));
                    t.width += $(coords.Date.MonthAndDay.OneLine.Number.ImageIndex).width + coords.Date.MonthAndDay.OneLine.Number.Spacing;
                }
            t.block.push(dot);
            t.width += dot.width + coords.Date.MonthAndDay.OneLine.Number.Spacing;
            var t2 = makeBlock(coords.Date.MonthAndDay.OneLine.Number, day);
            t.block = t.block.concat(t2.block);
            if (coords.Date.MonthAndDay.TwoDigitsDay)
                if (!div(day, 10)) {
                    t.block.splice(-1, 0, $c(coords.Date.MonthAndDay.OneLine.Number.ImageIndex));
                    t.width += $(coords.Date.MonthAndDay.OneLine.Number.ImageIndex).width + coords.Date.MonthAndDay.OneLine.Number.Spacing;
                }
            t.width += t2.width;
            renderBlock(t.block, t.width, coords.Date.MonthAndDay.OneLine.Number, "c_date");
        }
        draw.battery.icon = function() {
            var battery = Math.round(batteryT / (100 / (coords.Battery.Icon.ImagesCount - 1)));
            setPosN(coords.Battery.Icon, battery, "c_battery_icon");
        }
        draw.battery.text = function() {
            setTextPos(coords.Battery.Text, batteryT, "c_battery_text");
        }
        draw.battery.scale = function() {
            var end = Math.round(batteryT / (100 / (coords.Battery.Scale.Segments.length - 1)));
            for (var i = 0; i <= end; i++) {
                t = $c(coords.Battery.Scale.StartImageIndex + i);
                setPos(t, coords.Battery.Scale.Segments[i]);
                insert(t, "c_battery_scale");
            }
        }
        draw.analog.hours = function() {
            drowAnalog(coords.AnalogDialFace.Hours, analog[0]);
        }
        draw.analog.minutes = function() {
            drowAnalog(coords.AnalogDialFace.Minutes, analog[1]);
        }
        draw.analog.seconds = function() {
            drowAnalog(coords.AnalogDialFace.Seconds, analog[2]);
        }
        draw.status.alarm = function() {
            t = $c(coords.Status.Alarm.ImageIndexOn);
            t.style.left = coords.Status.Alarm.Coordinates.X + "px";
            t.style.top = coords.Status.Alarm.Coordinates.Y + "px";
            insert(t, "c_stat_alarm");
        }
        draw.status.bt = function() {
            if (bluetooth)
                t = $c(coords.Status.Bluetooth.ImageIndexOn);
            else
                t = $c(coords.Status.Bluetooth.ImageIndexOff);
            t.style.left = coords.Status.Bluetooth.Coordinates.X + "px";
            t.style.top = coords.Status.Bluetooth.Coordinates.Y + "px";
            insert(t, "c_stat_bt");
        }
        draw.status.dnd = function() {
            t = $c(coords.Status.DoNotDisturb.ImageIndexOn);
            t.style.left = coords.Status.DoNotDisturb.Coordinates.X + "px";
            t.style.top = coords.Status.DoNotDisturb.Coordinates.Y + "px";
            insert(t, "c_stat_dnd");
        }
        draw.status.lock = function() {
            t = $c(coords.Status.Lock.ImageIndexOn);
            t.style.left = coords.Status.Lock.Coordinates.X + "px";
            t.style.top = coords.Status.Lock.Coordinates.Y + "px";
            insert(t, "c_stat_lock");
        }
        draw.activity.cal = function() {
            setTextPos(coords.Activity.Calories, calories, "c_act_cal");
        }
        draw.activity.steps = function() {
            setTextPos(coords.Activity.Steps, steps, "c_act_steps");
        }
        draw.activity.stepsgoal = function() {
            setTextPos(coords.Activity.StepsGoal, stepsgoal, "c_act_stepsg");
        }
        draw.activity.pulse = function() {
            setTextPos(coords.Activity.Pulse, pulse, "c_act_pulse");
        }
        draw.activity.distance = function() {
            var dot = $c(coords.Activity.Distance.DecimalPointImageIndex),
                km = $c(coords.Activity.Distance.SuffixImageIndex);
            t = makeBlock(coords.Activity.Distance.Number, distance[0]);
            t.block.push(dot);
            t.width += dot.width + coords.Activity.Distance.Number.Spacing;
            var t2 = makeBlock(coords.Activity.Distance.Number, distance[1]);
            t.block = t.block.concat(t2.block);
            t.width += t2.width;
            t.block.push(km);
            t.width += km.width;
            renderBlock(t.block, t.width, coords.Activity.Distance.Number, "c_act_distance");
        }
        draw.weather.icon = function() {
            t = $c("weather");
            t.style.left = coords.Weather.Icon.Coordinates.X + "px";
            t.style.top = coords.Weather.Icon.Coordinates.Y + "px";
            insert(t, "c_weather_icon");
        }
        draw.weather.temp.oneline = function() {
            var sep = $c(coords.Weather.Temperature.Today.OneLine.DelimiterImageIndex),
                deg = $c(coords.Weather.Temperature.Today.OneLine.DegreesImageIndex),
                minus = temp[0] < 0 ? $c(coords.Weather.Temperature.Today.OneLine.MinusSignImageIndex) : 0;
            t = makeBlock(coords.Weather.Temperature.Today.OneLine.Number, Math.abs(temp[0]));
            if (minus != 0) {
                t.block.splice(0, 0, minus);
                t.width += minus.width;
            }
            t.block.push(sep);
            t.width += sep.width + coords.Weather.Temperature.Today.OneLine.Number.Spacing;
            var t2 = makeBlock(coords.Weather.Temperature.Today.OneLine.Number, Math.abs(temp[1]));
            minus = temp[1] < 0 ? $c(coords.Weather.Temperature.Today.OneLine.MinusSignImageIndex) : 0;
            if (minus != 0) {
                t2.block.splice(0, 0, minus);
                t2.width += minus.width;
            }
            t.block = t.block.concat(t2.block);
            t.width += t2.width;
            t.block.push(deg);
            t.width += deg.width;
            renderBlock(t.block, t.width, coords.Weather.Temperature.Today.OneLine.Number, "c_temp");
        }
        draw.weather.temp.sep = function() {
            var minus = temp[0] < 0 ? $c(coords.Weather.Temperature.Today.Separate.Day.MinusImageIndex) : 0;
            t = makeBlock(coords.Weather.Temperature.Today.Separate.Day.Number, Math.abs(temp[0]));
            if ('DegreesImageIndex' in coords.Weather.Temperature.Today.Separate.Day) {
                var deg = $c(coords.Weather.Temperature.Today.Separate.Day.DegreesImageIndex);
                t.block.push(deg);
                t.width += deg.width + coords.Weather.Temperature.Today.Separate.Day.Number.Spacing;
            }
            if (minus != 0) {
                t.block.splice(0, 0, minus);
                t.width += minus.width;
            }
            renderBlock(t.block, t.width, coords.Weather.Temperature.Today.Separate.Day.Number);
            minus = temp[1] < 0 ? $c(coords.Weather.Temperature.Today.Separate.Night.MinusImageIndex) : 0;
            t = makeBlock(coords.Weather.Temperature.Today.Separate.Night.Number, Math.abs(temp[1]));
            if ('DegreesImageIndex' in coords.Weather.Temperature.Today.Separate.Night) {
                var deg = $c(coords.Weather.Temperature.Today.Separate.Night.DegreesImageIndex);
                t.block.push(deg);
                t.width += deg.width + coords.Weather.Temperature.Today.Separate.Night.Number.Spacing;
            }
            if (minus != 0) {
                t.block.splice(0, 0, minus);
                t.width += minus.width;
            }
            renderBlock(t.block, t.width, coords.Weather.Temperature.Today.Separate.Night.Number, "c_temp");
        }
        draw.weather.temp.current = function() {
            var minus = temp[0] < 0 ? $c(coords.Weather.Temperature.Today.Separate.Day.MinusImageIndex) : 0;
            t = makeBlock(coords.Weather.Temperature.Current.Number, Math.abs(temp[0]));
            if ('DegreesImageIndex' in coords.Weather.Temperature.Current) {
                var deg = $c(coords.Weather.Temperature.Current.DegreesImageIndex);
                t.block.push(deg);
                t.width += deg.width + coords.Weather.Temperature.Current.Number.Spacing;
            }
            if (minus != 0) {
                t.block.splice(0, 0, minus);
                t.width += minus.width;
            }
            renderBlock(t.block, t.width, coords.Weather.Temperature.Current.Number, "c_temp");
        }
        draw.weather.air = function() {
            setPosN(coords.Weather.AirPollution.Icon, 0, "c_air");
        }
        draw.stepsprogress.circle = function() {
            var col = coords.StepsProgress.Circle.Color.replace("0x", "#"),
                full = Math.floor(2 * coords.StepsProgress.Circle.RadiusX * Math.PI / 360 * (coords.StepsProgress.Circle.EndAngle - coords.StepsProgress.Circle.StartAngle));
            var fill = Math.round(steps / (stepsgoal / full));
            if (fill > full) fill = full;
            $('svg-cont-steps').innerHTML += "<ellipse transform=\"rotate(" + (-90 + coords.StepsProgress.Circle.StartAngle) + " " + coords.StepsProgress.Circle.CenterX + " " + coords.StepsProgress.Circle.CenterY + ")\" cx=\"" + coords.StepsProgress.Circle.CenterX + "\" cy=\"" + coords.StepsProgress.Circle.CenterY + "\" rx=\"" + coords.StepsProgress.Circle.RadiusX + "\" ry=\"" + coords.StepsProgress.Circle.RadiusY + "\" fill=\"rgba(255,255,255,0)\" stroke-width=\"" + coords.StepsProgress.Circle.Width + "\" stroke=\"" + col + "\" stroke-dasharray=\"" + fill + " " + (full - fill) + "\" stroke-linecap=\"none\"></ellipse>";
        }
        draw.stepsprogress.linear = function() {
            var end = Math.round(steps / (stepsgoal / (coords.StepsProgress.Linear.Segments.length - 1))) - 1;
            if (end > coords.StepsProgress.Linear.Segments.length - 1)
                end = coords.StepsProgress.Linear.Segments.length - 1;
            for (var i = 0; i <= end; i++) {
                t = $c(coords.StepsProgress.Linear.StartImageIndex + i);
                setPos(t, coords.StepsProgress.Linear.Segments[i]);
                insert(t, "c_steps_linear");
            }
        }

    </script>
    <!--Constructor-->
    <script type="text/javascript">
        function disableByIdArray(elements) {
            var end = elements.length;
            for (var i = 0; i < end; i++)
                $(elements[i]).setAttribute("disabled", "");
        }

        function enableByIdArray(elements) {
            var end = elements.length;
            for (var i = 0; i < end; i++)
                $(elements[i]).removeAttribute("disabled");
        }
        var editor = {};
        editor.init = {};
        editor.onchange = {};
        editor.init.time = function() {
            if ('Time' in coords) {
                $("c-time-check-sec").onchange = function() {
                    var elem = ["c-time-st-x", "c-time-st-y", "c-time-st-f", "c-time-st-c", "c-time-so-x", "c-time-so-y", "c-time-so-f", "c-time-so-c"];
                    if ($("c-time-check-sec").checked) {
                        coords.Time.Seconds = {};
                        coords.Time.Seconds.Tens = {};
                        coords.Time.Seconds.Ones = {};
                        coords.Time.Seconds.Tens.X = Number($("c-time-st-x").value);
                        coords.Time.Seconds.Tens.Y = Number($("c-time-st-y").value);
                        coords.Time.Seconds.Tens.ImageIndex = Number($("c-time-st-f").value);
                        coords.Time.Seconds.Tens.ImagesCount = Number($("c-time-st-c").value);
                        coords.Time.Seconds.Ones.X = Number($("c-time-so-x").value);
                        coords.Time.Seconds.Ones.Y = Number($("c-time-so-y").value);
                        coords.Time.Seconds.Ones.ImageIndex = Number($("c-time-so-f").value);
                        coords.Time.Seconds.Ones.ImagesCount = Number($("c-time-so-c").value);
                        enableByIdArray(elem);
                        draw.time.seconds();
                    } else {
                        delete coords.Time.Seconds;
                        disableByIdArray(elem);
                        removeByClass("c_sec");
                    }
                }
                $("c-time-rad-12").onchange = function() {
                    var elem = ["c-time-format-x", "c-time-format-y", "c-time-format-a", "c-time-format-p"];
                    if (this.id == "c-time-rad-12") {
                        coords.Time.AmPm = {};
                        coords.Time.AmPm.X = Number($("c-time-format-x").value);
                        coords.Time.AmPm.Y = Number($("c-time-format-y").value);
                        coords.Time.AmPm.ImageIndexAm = Number($("c-time-format-a").value);
                        coords.Time.AmPm.ImageIndexPm = Number($("c-time-format-p").value);
                        enableByIdArray(elem);
                    } else {
                        delete coords.Time.AmPm;
                        disableByIdArray(elem);
                    }
                    removeByClass("c_time_am");
                    removeByClass("c_time");
                    draw.time.time();
                }
                $("c-time-rad-24").onchange = $("c-time-rad-12").onchange;
                $("c-time-ht-x").value = coords.Time.Hours.Tens.X;
                $("c-time-ht-y").value = coords.Time.Hours.Tens.Y;
                $("c-time-ht-f").value = coords.Time.Hours.Tens.ImageIndex;
                $("c-time-ht-c").value = coords.Time.Hours.Tens.ImagesCount;
                $("c-time-ho-x").value = coords.Time.Hours.Ones.X;
                $("c-time-ho-y").value = coords.Time.Hours.Ones.Y;
                $("c-time-ho-f").value = coords.Time.Hours.Ones.ImageIndex;
                $("c-time-ho-c").value = coords.Time.Hours.Ones.ImagesCount;
                $("c-time-mt-x").value = coords.Time.Minutes.Tens.X;
                $("c-time-mt-y").value = coords.Time.Minutes.Tens.Y;
                $("c-time-mt-f").value = coords.Time.Minutes.Tens.ImageIndex;
                $("c-time-mt-c").value = coords.Time.Minutes.Tens.ImagesCount;
                $("c-time-mo-x").value = coords.Time.Minutes.Ones.X;
                $("c-time-mo-y").value = coords.Time.Minutes.Ones.Y;
                $("c-time-mo-f").value = coords.Time.Minutes.Ones.ImageIndex;
                $("c-time-mo-c").value = coords.Time.Minutes.Ones.ImagesCount;
                if ('Seconds' in coords.Time) {
                    $("c-time-check-sec").checked = true;
                    $("c-time-st-x").value = coords.Time.Seconds.Tens.X;
                    $("c-time-st-y").value = coords.Time.Seconds.Tens.Y;
                    $("c-time-st-f").value = coords.Time.Seconds.Tens.ImageIndex;
                    $("c-time-st-c").value = coords.Time.Seconds.Tens.ImagesCount;
                    $("c-time-so-x").value = coords.Time.Seconds.Ones.X;
                    $("c-time-so-y").value = coords.Time.Seconds.Ones.Y;
                    $("c-time-so-f").value = coords.Time.Seconds.Ones.ImageIndex;
                    $("c-time-so-c").value = coords.Time.Seconds.Ones.ImagesCount;
                } else {
                    var elem = ["c-time-st-x", "c-time-st-y", "c-time-st-f", "c-time-st-c", "c-time-so-x", "c-time-so-y", "c-time-so-f", "c-time-so-c"];
                    disableByIdArray(elem);
                }
                if ('AmPm' in coords.Time) {
                    $("c-time-rad-12").checked = true;
                    $("c-time-format-x").value = coords.Time.AmPm.X;
                    $("c-time-format-y").value = coords.Time.AmPm.Y;
                    $("c-time-format-a").value = coords.Time.AmPm.ImageIndexAm;
                    $("c-time-format-p").value = coords.Time.AmPm.ImageIndexPm;
                } else {
                    $("c-time-rad-24").checked = true;
                    var elem = ["c-time-format-x", "c-time-format-y", "c-time-format-a", "c-time-format-p"];
                    disableByIdArray(elem);
                }
            } else {
                var elem = ["c-time-st-x", "c-time-st-y", "c-time-st-f", "c-time-st-c", "c-time-so-x", "c-time-so-y", "c-time-so-f", "c-time-so-c", "c-time-format-x", "c-time-format-y", "c-time-format-a", "c-time-format-p", "c-time-ht-x", "c-time-ht-y", "c-time-ht-f", "c-time-ht-c", "c-time-ho-x", "c-time-ho-y", "c-time-ho-f", "c-time-ho-c", "c-time-mt-x", "c-time-mt-y", "c-time-mt-f", "c-time-mt-c", "c-time-mo-x", "c-time-mo-y", "c-time-mo-f", "c-time-mo-c", "c-time-rad-12", "c-time-rad-24", "c-time-check-sec"];
                disableByIdArray(elem);
            }
        }
        editor.onchange.time = function() {
            coords.Time.Hours.Tens.X = Number($("c-time-ht-x").value);
            coords.Time.Hours.Tens.Y = Number($("c-time-ht-y").value);
            coords.Time.Hours.Tens.ImageIndex = Number($("c-time-ht-f").value);
            coords.Time.Hours.Tens.ImagesCount = Number($("c-time-ht-c").value);
            coords.Time.Hours.Ones.X = Number($("c-time-ho-x").value);
            coords.Time.Hours.Ones.Y = Number($("c-time-ho-y").value);
            coords.Time.Hours.Ones.ImageIndex = Number($("c-time-ho-f").value);
            coords.Time.Hours.Ones.ImagesCount = Number($("c-time-ho-c").value);
            coords.Time.Minutes.Tens.X = Number($("c-time-mt-x").value);
            coords.Time.Minutes.Tens.Y = Number($("c-time-mt-y").value);
            coords.Time.Minutes.Tens.ImageIndex = Number($("c-time-mt-f").value);
            coords.Time.Minutes.Tens.ImagesCount = Number($("c-time-mt-c").value);
            coords.Time.Minutes.Ones.X = Number($("c-time-mo-x").value);
            coords.Time.Minutes.Ones.Y = Number($("c-time-mo-y").value);
            coords.Time.Minutes.Ones.ImageIndex = Number($("c-time-mo-f").value);
            coords.Time.Minutes.Ones.ImagesCount = Number($("c-time-mo-c").value);
            if ('Seconds' in coords.Time) {
                coords.Time.Seconds.Tens.X = Number($("c-time-st-x").value);
                coords.Time.Seconds.Tens.Y = Number($("c-time-st-y").value);
                coords.Time.Seconds.Tens.ImageIndex = Number($("c-time-st-f").value);
                coords.Time.Seconds.Tens.ImagesCount = Number($("c-time-st-c").value);
                coords.Time.Seconds.Ones.X = Number($("c-time-so-x").value);
                coords.Time.Seconds.Ones.Y = Number($("c-time-so-y").value);
                coords.Time.Seconds.Ones.ImageIndex = Number($("c-time-so-f").value);
                coords.Time.Seconds.Ones.ImagesCount = Number($("c-time-so-c").value);
                removeByClass("c_sec");
                draw.time.seconds();
            }
            if ('AmPm' in coords.Time) {
                coords.Time.AmPm.X = Number($("c-time-format-x").value);
                coords.Time.AmPm.Y = Number($("c-time-format-y").value);
                coords.Time.AmPm.ImageIndexAm = Number($("c-time-format-a").value);
                coords.Time.AmPm.ImageIndexPm = Number($("c-time-format-p").value);
                removeByClass("c_time_am");
            }
            removeByClass("c_time");
            if ('Time' in coords)
                draw.time.time();
        }

    </script>
    <script type="text/javascript" src="html2canvas.comp.js"></script>
    <script type="text/javascript">
        function makepng() {
            var el = "watchfaceblock";
            if ($("makepngwithwatch").checked)
                el = "watchfaceimage"
            html2canvas($(el), {
                onrendered: function(canvas) {
                    ctx = canvas.getContext("2d");
                    savedData = new Image();
                    savedData.src = canvas.toDataURL("image/png");
                    var a = document.createElement('a');
                    a.href = savedData.src;
                    a.download = wfname + '.png';
                    a.click();
                    delete a;
                    delete savedData;
                }
            });
        }

        function exportjs() {
            var a = document.createElement('a');
            a.href = 'data:application/octet-stream;base64, ' + btoa(JSON.stringify(coords, null, 4));
            a.download = wfname + '.json';
            a.click();
        }

        function fillarea() {
            $("codearea").innerHTML = syntaxHighlight(JSON.stringify(coords, null, 4));
        }
        $("codearea").onblur = function(){
            coords = JSON.parse($("codearea").innerHTML.replace(/<\w*\s\w*="\w*">|<.\w*>/g, ''));
            makeWf();
            $("codearea").innerHTML = syntaxHighlight(JSON.stringify(coords, null, 4));
        }

        function syntaxHighlight(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function(match) {
                var cls = 'number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'key';
                    } else {
                        cls = 'string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'boolean';
                } else if (/null/.test(match)) {
                    cls = 'null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }

    </script>
</body>

</html>
